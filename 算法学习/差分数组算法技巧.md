差分数组的主要适用场景，是频繁对原始数组nums的某个区间的元素，进行增减。

>   比如说，给定一个数组nums,要求对区间nums[2,5]全部加1, 再给nums[3,7]全部减3，再给nums[1,3]全部加2，诸如此类...

### 一、差分数组的基本操作



构造数组nums的差分数组：

```c++
vector<int>
diff[0] = nums[0];
for (int i = 1; i < diff.size(); i++) {
    diff[i] = nums[i] - nums[i - 1];    /* diff[i]就是nums[i]和nums[i-1]之差 */ 
}
```



处理差分数组，对nums数组闭区间[i, j]中的元素增加val: 

```c++
diff[i] += val;          /* nums[i...]中所有元素增加val  */
if (j+1 < diff.size()) {
    diff[j+1] -= val;    /* nums[j+1...]中所有元素减少val */
}
```



根据差分数组构造结果数组:

```c++
vector<int> res(diff.size(), 0);
res[0] = diff[0];
for (int i = 0;i < diff.size(); i++) {
    res[i] = res[i-1] + diff[i];  		/* res[i]就是差分数组闭区间[0,i]的前缀和 */
}
return res;
```



差分数组工具类：

```c++
class Difference {
private:
    vector<int> diff;
public:
    /* 输入一个数组nums, 将构造其差分数组 */
    explicit Difference(vector<int>& nums) {
        assert(!nums.empty());
        diff = vector<int>(nums.size(), 0);
        diff[0] = nums[0];
        for (int i = 1; i < diff.size(); i++) {
            diff[i] = nums[i] - nums[i - 1];
        }
    }
    /* 给闭区间[i,j]中每个元素增加val(可以是负数)*/
    void increment(int i, int j, int val) {
        diff[i] += val;
        if (j+1 < diff.size()) {
            diff[j+1] -= val;
        }
    }
    /* 使用差分数组构造结果数组 */
    vector<int> result() {
        vector<int> res(diff.size(), 0);
        res[0] = diff[0];
        for (int i = 0;i < diff.size(); i++) {
            res[i] = res[i-1] + diff[i];
        }
        return res;
    }
};
```





### 二、差分数组的原理



diff差分数组，在闭区间[0, i]的前缀和，就是nums[i]:

```c
/* diff还原nums的推导过程 */ 
diff[0]   =  nums[0]
diff[1]   =  nums[1]   -  nums[0]
diff[2]   =  nums[2]   -  nums[1]
     	 ...
diff[i-1] =  nums[i-1] -  nums[i-2]  
diff[i]   =  nums[i] -  nums[i-1]

/* diff在闭区间[0,i]的前缀和， 即为nums[i] */   
nums[i] = diff[0]+...diff[i]  =  nums[i-1] + diff[i]   
```



使用差分数组对闭区间进行增减：

```c++
// diff[i] += 3 相当于给nums[i...]所有的元素都加3
num[i]    = diff[0] +...+ diff[i]
nums[i+1] = diff[0] +...+ diff[i] + diff[i+1]

// diff[j+1] -= 3 相当于给nums[j+1...]所有的元素都减3
nums[j+1] = diff[0] +...+ diff[j+1]
nums[j+...] =diff[0] +...+ diff[j+...]

// 对nums[i]...nums[j]中所有元素都加3
diff[i] += 3
diff[j+1] -= 3   
```







### 三、应用差分数组的技巧



使用nums的差分数组，对某个区间的元素进行增减：

```c++
/* 差分数组：区间加法 */
class Solution370 {
public:
    vector<int> getModifiedArray(int length, vector<vector<int>> &updates) {
        vector<int> nums(length, 0);

        // 构造差分数组： 对于每个nums[i], 计算当前元素与之前一个元素的差分量
        vector<int> diff(nums.size(), 0);
        diff[0] = nums[0];
        for (int i = 1; i < diff.size(); i++) {
            diff[i] = nums[i] - nums[i - 1];
        }

        // 执行每个操作
        for (auto &update: updates) {
            int i = update[0], j = update[1], val = update[2];
            diff[i] += val;         // 对nums[i...]增加val
            if (j + 1 < diff.size()) {
                diff[j + 1] -= val;   // 对nums[j+1..]减少val
            }
        }

        // 使用差分数组的前缀和，计算结果数组
        vector<int> res(diff.size(), 0);
        res[0] = diff[0];
        for (int i = 1; i < diff.size(); i++) {
            // diff数组闭区间[0,i]的前缀和为res[i]
            res[i] = diff[i] + res[i - 1];
        }
        return res;
    }
};
```

